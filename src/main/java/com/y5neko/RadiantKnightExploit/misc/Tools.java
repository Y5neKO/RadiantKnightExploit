package com.y5neko.RadiantKnightExploit.misc;

import com.gn.lab.GNButton;
import javafx.geometry.Insets;
import javafx.scene.Node;
import javafx.scene.control.Button;
import javafx.scene.control.ContentDisplay;
import javafx.scene.control.ScrollPane;
import javafx.scene.image.Image;
import javafx.scene.image.ImageView;
import javafx.scene.layout.*;
import javafx.scene.paint.Color;
import javafx.scene.text.Font;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;

public class Tools {
    public static Button getImgButton(String imgPath) {
        Button button = new Button();
        Image imageClose = new Image(imgPath);
        ImageView imageViewClose = new ImageView(imageClose);
        imageViewClose.setFitHeight(20);
        imageViewClose.setPreserveRatio(true);
        button.setGraphic(imageViewClose);
        button.setBackground(new Background(new BackgroundFill(Color.TRANSPARENT, CornerRadii.EMPTY, Insets.EMPTY)));
        button.setContentDisplay(ContentDisplay.GRAPHIC_ONLY); // 仅显示图形内容

        return button;
    }

    public static GNButton getGNButton(String string) {
        GNButton button = new GNButton();
        button.setText(string);
        button.setStyle("-gn-transition-color : #00000000; -gn-transition-text : black;");
        button.setMinHeight(35);
        button.setFont(Font.font("Microsoft YaHei", 14));
        return button;
    }

    public static ScrollPane getScrollPane(Node node, boolean scrollBarPolicy) {
        ScrollPane scrollPane = new ScrollPane();
        scrollPane.setContent(node);
        if (scrollBarPolicy){
            scrollPane.setVbarPolicy(ScrollPane.ScrollBarPolicy.ALWAYS);
        }
        scrollPane.setFitToWidth(true);
        scrollPane.getStylesheets().add("css/ScrollPane.css");
        scrollPane.getStyleClass().add("edge-to-edge");
        return scrollPane;
    }

    /**
     * 获取一个含有指定资产漏洞的VBox
     * @param vulTypes 资产列表
     * @return VBox
     */
    public static VBox getVulTypeBox(String[] vulTypes) {
        VBox vulTypeBox = new VBox();
        for (String vulType : vulTypes) {
            GNButton buttonVul = Tools.getGNButton(vulType);
            buttonVul.setOnMouseClicked(event -> {
                System.out.println(vulType);
            });
            vulTypeBox.getChildren().add(buttonVul);
        }
        return vulTypeBox;
    }

    public static VBox getVulTypeBox(String[] vulTypes, GridPane gridPane, String assetType, HBox removeNededHBox) {
        VBox vulTypeBox = new VBox();
        for (String vulType : vulTypes) {
            GNButton buttonVul = Tools.getGNButton(vulType);
            buttonVul.setOnMouseClicked(event -> {
                System.out.println(vulType);
                System.out.println("清除了VBox");
                gridPane.getChildren().remove(gridPane.getChildren().get(1));

                try {
                    Class<?> clazz = Class.forName("com.y5neko.RadiantKnightExploit.exp." + assetType + "." + vulType);
                    Method method = clazz.getMethod("getHBox");
                    HBox hBox = (HBox) method.invoke(null);
                    gridPane.add(hBox, 1, 0, 1, 1);
                } catch (ClassNotFoundException | InvocationTargetException | NoSuchMethodException |
                         IllegalAccessException e) {
                    throw new RuntimeException(e);
                }
            });
            vulTypeBox.getChildren().add(buttonVul);
        }
        return vulTypeBox;
    }
}
